<UserControl x:Class="CURSE.Views.Notes"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:CURSE.Views"
             xmlns:vm="clr-namespace:CURSE.ViewModels"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d">

    <UserControl.Resources>
        <ControlTemplate x:Key="ResizeThumbTemplate" TargetType="Thumb">
            <Grid Background="#01000000" Cursor="SizeNWSE">
                <Path Data="M0,10 L10,10 10,0"
                      Stroke="DarkGray" StrokeThickness="2"
                      Stretch="None" HorizontalAlignment="Right"
                      VerticalAlignment="Bottom"/>
                <Path Data="M0,10 L10,10 10,0"
                      Stroke="White" StrokeThickness="1"
                      Stretch="None" HorizontalAlignment="Right"    
                      VerticalAlignment="Bottom"/>
            </Grid>
        </ControlTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
     
        <!-- Панель команд -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Grid.Row="0">
            <Image Source="/Views/Resources/Plus.png" Cursor="Hand" Margin="5">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseLeftButtonDown">
                        <i:InvokeCommandAction Command="{Binding AddSmallNoteCommand}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </Image>
            <Image Source="/Views/Resources/Bold.png" Margin="5"
                   Cursor="Hand">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseLeftButtonDown">
                        <i:InvokeCommandAction Command="{Binding ToggleBoldCommand}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </Image>
        </StackPanel>

        <!-- Основной ScrollViewer и Canvas -->
        <ScrollViewer x:Name="MainScrollViewer" 
              Grid.Row="2" Grid.Column="2"
              VerticalScrollBarVisibility="Auto" 
              HorizontalScrollBarVisibility="Auto" 
              Margin="10,0,10,10">
            <Canvas x:Name="Note" Background="Transparent" Width="auto"  Height="1500">
                <ItemsControl ItemsSource="{Binding Notes}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <!-- Применяем Canvas.Left и Top к корневому элементу внутри шаблона -->
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Canvas>
                            <Grid Width="200"
                          Height="180"
                          Background="Transparent"
                          Canvas.Left="{Binding X,Mode=TwoWay}"
                          Canvas.Top="{Binding Y,Mode=TwoWay}">
                                <i:Interaction.Behaviors>
                                    <vm:CanvasDragBehavior/>
                                </i:Interaction.Behaviors>

                                <!-- Верхняя панель -->
                                    <Border Height="30" Background="Brown" VerticalAlignment="Top">
                                        <Button  Foreground="red" Background="brown" BorderBrush="brown" FontSize="20" HorizontalAlignment="Right" Width="20" 
                                                  Command="{Binding DataContext.DeleteSmallNoteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                  CommandParameter="{Binding}"
                                                 >X</Button>
                                    </Border>
                                


                                    <!-- Редактор -->
                                <RichTextBox x:Name="MyRichTextBox" 
                                     FontSize="20"
                                     AcceptsReturn="True"
                                     Background="Yellow"
                                     Margin="0,30,0,0"
                                     IsDocumentEnabled="True">
                                    <i:Interaction.Behaviors>
                                            <vm:PasteImageBehavior />
                                            <vm:RichTextBoxKeyBehavior />
                                        <vm:DisableParentScrollOnFocusBehavior />
                                    </i:Interaction.Behaviors>
                                    <RichTextBox.Resources>
                                        <Style TargetType="Paragraph">
                                            <Setter Property="Margin" Value="0"/>
                                        </Style>
                                    </RichTextBox.Resources>
                                </RichTextBox>

                                <!-- Уголок для растягивания -->
                                <Thumb x:Name="ResizeThumb"
                               Width="15"
                               Height="15"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Bottom"
                               Cursor="SizeNWSE"
                               DragDelta="ResizeThumb_DragDelta"
                               Template="{StaticResource ResizeThumbTemplate}"
                               Panel.ZIndex="10"/>
                            </Grid>
                            </Canvas>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Canvas>
        </ScrollViewer>

    </Grid>
</UserControl>
